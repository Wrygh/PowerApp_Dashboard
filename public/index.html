<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>PowerStep Dashboard</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&family=Roboto:wght@300;400;700&display=swap" rel="stylesheet">
  <style>
    /* Global Styles */
    body {
      font-family: 'Roboto', sans-serif;
      background-color: #111;
      color: white;
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    h1 {
      font-size: 2.5em;
      color: #00bfff;
      text-align: center;
      text-shadow: 0 0 10px rgba(0, 191, 255, 0.5);
      margin-top: 50px;
    }

    p.description {
      text-align: center;
      font-size: 1.2em;
      color: #bbb;
      margin: 20px 0;
      padding: 0 10px;
    }

    /* Logo */
    .logo {
      display: block;
      margin: 0 auto;
      width: 100px;
      height: auto;
      margin-bottom: 20px;
      box-shadow: 0 0 15px rgba(0, 191, 255, 0.6);
    }

    /* Container for Tiles */
    .tile-container {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      margin: 30px auto;
    }

    .tile {
      background: #1a1a1a;
      color: #ffffff;
      border-radius: 10px;
      padding: 20px;
      margin: 10px;
      flex: 1 1 250px;
      box-shadow: 0 0 15px rgba(0, 191, 255, 0.2);
      overflow: visible;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
    }

    .tile h3 {
      margin-bottom: 15px;
      font-size: 1.5em;
    }

    /* Battery Tile Styles */
    .battery-container {
      position: relative;
      width: 180px;
      height: 180px;
      margin: 0 auto;
    }

    .gauge-circle {
      width: 100%;
      height: 100%;
      border-radius: 50%;
      background: conic-gradient(#00bfff 0%, #111 0%);
      transition: background 0.5s ease;
      box-shadow: 0 0 20px rgba(0, 191, 255, 0.6);
    }

    .battery-text {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      font-size: 1.5em;
      font-weight: bold;
      color: #ffffff;
    }

    /* Graph styles */
    #stepGraph {
      width: 100%;
      height: 200px;
      margin-top: 20px;
    }

    /* Flex layout for Step Count and Battery next to each other */
    .tile-container .tile-step-count,
    .tile-container .tile-battery {
      flex: 1 1 40%;
    }

    /* Voltage and LED Status tile */
    .tile-voltage,
    .tile-led-status {
      flex: 1 1 40%;
    }

    /* Download Tile Styles */
    .tile-download {
      flex: 1 1 100%;
      text-align: center;
      padding: 10px 0;
      font-size: 1.2em;
    }

    .tile-download a {
      color: #00bfff;
      text-decoration: none;
      font-weight: bold;
    }

    /* Styling for the graph */
    .graph-container {
      display: flex;
      justify-content: center;
      align-items: center;
      margin-top: 20px;
    }
  </style>
</head>

<body>
  <!-- Logo at the top -->
  <img src="logo.png" alt="PowerStep Logo" class="logo">

  <h1>PowerStep Realtime Dashboard</h1>
  <p class="description">
    <strong>PowerStep</strong> is a project developed by <strong>ByteForce</strong>, a team of Computer Engineering students from <strong>Cavite State University - Carmona Campus</strong>. It is an IoT-based system designed specifically for areas with high foot traffic, such as school hallways and walkways, to monitor movement and convert the energy from footsteps into usable power for LED lighting. By tracking data such as step count, voltage generated, battery level, and LED status, PowerStep promotes sustainability and energy efficiency within the campus.
    <br><br>
    This dashboard serves as a server that integrates the PowerStep system with <strong>PowerApp</strong>—a user-friendly mobile application that provides access to most of the system’s core features through IoT technology.
  </p>

  <!-- Tile Container -->
  <div class="tile-container">
    <!-- Step Count & Graph -->
    <div class="tile tile-step-count">
      <h3>Step Count: <span id="stepCount">--</span></h3>
      <div class="graph-container">
        <canvas id="stepGraph"></canvas>
      </div>
    </div>

    <!-- Battery Tile -->
    <div class="tile tile-battery">
      <h3>Battery Level</h3>
      <div class="battery-container">
        <div id="batteryGauge" class="gauge-circle"></div>
        <div id="batteryText" class="battery-text">--%</div>
      </div>
    </div>

    <!-- Voltage Input Tile -->
    <div class="tile tile-voltage">
      <h3>Voltage Input</h3>
      <div id="voltage">--</div>
    </div>

    <!-- LED Status Tile -->
    <div class="tile tile-led-status">
      <h3>LED Status</h3>
      <div id="ledStatus">Loading...</div>
    </div>

    <!-- Download Tile -->
    <div class="tile tile-download">
      <h3>Download & Install PowerApp</h3>
      <a href="https://tinyurl.com/PowerAppInstaller" target="_blank">Download PowerApp</a>
    </div>
  </div>

  <!-- Script for Chart.js and Data Handling -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script>
    const stepGraphCtx = document.getElementById('stepGraph').getContext('2d');
    const stepGraph = new Chart(stepGraphCtx, {
      type: 'line',
      data: {
        labels: [],
        datasets: [{
          label: 'Step Count',
          data: [],
          borderColor: '#00bfff',
          fill: false,
        }]
      },
      options: {
        scales: {
          x: {
            type: 'linear',
            position: 'bottom',
          },
          y: {
            min: 0,
            ticks: {
              stepSize: 1,
            }
          }
        }
      }
    });

    // Simulate Data (Replace with actual API or real data fetching)
    async function fetchData() {
      try {
        const response = await fetch('/status');
        const data = await response.json();

        // Step Count
        document.getElementById('stepCount').textContent = data.stepCount;

        // Battery Gauge
        const battery = data.battery || 0;
        document.getElementById('batteryText').textContent = battery + '%';
        document.getElementById('batteryGauge').style.background = `conic-gradient(#00bfff ${battery}%, #111 ${battery}%)`;

        // Voltage
        document.getElementById('voltage').textContent = `${data.voltage} V`;

        // LED Status
        const ledStatusText = ['LED 1 OFF', 'LED 1 ON', 'LED 2 OFF', 'LED 2 ON', 'LED 3 OFF', 'LED 3 ON'][data.ledStatus - 1] || 'Unknown';
        document.getElementById('ledStatus').textContent = ledStatusText;

        // Update Step Graph
        if (stepGraph.data.labels.length > 10) {
          stepGraph.data.labels.shift();
          stepGraph.data.datasets[0].data.shift();
        }
        stepGraph.data.labels.push(Date.now());
        stepGraph.data.datasets[0].data.push(data.stepCount);
        stepGraph.update();
      } catch (error) {
        console.error("Error fetching data", error);
      }
    }

    setInterval(fetchData, 1000); // Update data every second
  </script>
</body>

</html>
