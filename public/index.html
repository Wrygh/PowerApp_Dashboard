<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>PowerStep Dashboard</title>

  <!-- Orbitron Font -->
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;600;800&display=swap" rel="stylesheet">

  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <style>
    body {
      background: #000;
      color: #fff;
      font-family: 'Orbitron', sans-serif;
      margin: 0;
      padding: 20px;
    }

    .logo-title {
      text-align: center;
    }

    .logo {
      width: 120px;
      filter: drop-shadow(0 0 15px #00bfff);
    }

    .title {
      font-size: 2.5em;
      color: #00bfff;
      text-shadow: 0 0 25px #00bfff;
      margin: 10px 0;
    }

    .description {
      text-align: center;
      max-width: 1000px;
      margin: 0 auto 40px auto;
      font-size: 1em;
      line-height: 1.6;
      color: #ccc;
    }

    .dashboard {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
      gap: 20px;
      max-width: 1200px;
      margin: auto;
    }

    .tile {
      background: #111;
      padding: 20px;
      border-radius: 15px;
      box-shadow: 0 0 15px rgba(0, 191, 255, 0.2);
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    .tile h2 {
      margin-bottom: 10px;
      color: #00bfff;
    }

    .data {
      font-size: 2em;
      font-weight: bold;
      color: #fff;
    }

    .battery-container {
      position: relative;
      width: 180px;
      height: 180px;
      margin: auto;
    }

    .gauge-circle {
      width: 100%;
      height: 100%;
      border-radius: 50%;
      background: conic-gradient(#00bfff 0%, #111 0%);
      transition: background 0.5s ease;
    }

    .battery-text {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      font-size: 1.5em;
      color: #fff;
    }

    canvas {
      width: 100% !important;
      height: 200px !important;
    }

    .led-status-line {
      text-align: left;
      width: 100%;
      font-size: 1em;
      line-height: 1.6;
    }

    a {
      color: #00bfff;
      text-decoration: none;
    }

    a:hover {
      text-decoration: underline;
    }
  </style>
</head>
<body>
  <!-- Header -->
  <div class="logo-title">
    <img src="assets/logo.png" class="logo" alt="PowerStep Logo">
    <h1 class="title">PowerStep Dashboard</h1>
  </div>

  <!-- Description -->
  <p class="description">
    <strong>PowerStep</strong> is a project developed by <strong>ByteForce</strong>, a team of Computer Engineering students from <strong>Cavite State University - Carmona Campus</strong>. It is an IoT-based system designed specifically for areas with high foot traffic, such as school hallways and walkways, to monitor movement and convert the energy from footsteps into usable power for LED lighting. By tracking data such as step count, voltage generated, battery level, and LED status, PowerStep promotes sustainability and energy efficiency within the campus.
    <br><br>
    This dashboard serves as a server that integrates the PowerStep system with <strong>PowerApp</strong>—a user-friendly mobile application that provides access to most of the system’s core features through IoT technology.
  </p>

  <!-- Dashboard Tiles -->
  <div class="dashboard">
    <!-- Step Count Tile -->
    <div class="tile steps-tile">
      <h2>Step Count</h2>
      <div class="data" id="stepCount">--</div>
      <h3>Today's Total Steps</h3>
      <div class="data" id="todaySteps">--</div>
    </div>

    <!-- Step Chart -->
    <div class="tile graph-tile">
      <h2>Step Tracker</h2>
      <canvas id="stepChart"></canvas>
    </div>

    <!-- Battery Level -->
    <div class="tile battery-tile">
      <h2>Battery Level</h2>
      <div class="battery-container">
        <div id="batteryGauge" class="gauge-circle"></div>
        <div id="batteryText" class="battery-text">--%</div>
      </div>
    </div>

    <!-- LED Status -->
    <div class="tile led-tile">
      <h2>LED Status</h2>
      <div class="led-status-line" id="ledStatus">
        LED1 status: --<br>
        LED2 status: --<br>
        LED3 status: --<br>
        LED4 status: --<br>
        LED5 status: --<br>
        LED6 status: --
      </div>
    </div>

    <!-- Voltage Input -->
    <div class="tile voltage-tile">
      <h2>Voltage Input</h2>
      <div class="data" id="voltage">-- V</div>
    </div>

    <!-- PowerApp Download -->
    <div class="tile download-tile">
      <h2>Download & Install PowerApp</h2>
      <a href="https://tinyurl.com/PowerAppInstaller" target="_blank">https://tinyurl.com/PowerAppInstaller</a>
    </div>
  </div>

  <!-- JS for Data and Chart -->
  <script>
    const ctx = document.getElementById('stepChart').getContext('2d');
    const stepChart = new Chart(ctx, {
      type: 'line',
      data: {
        labels: [],
        datasets: [{
          label: 'Steps Over Time',
          data: [],
          backgroundColor: 'rgba(0, 191, 255, 0.2)',
          borderColor: '#00bfff',
          borderWidth: 2,
          pointRadius: 2,
          fill: true,
          tension: 0.3
        }]
      },
      options: {
        scales: {
          y: {
            beginAtZero: true,
            ticks: { stepSize: 1, precision: 0 }
          }
        }
      }
    });

    let stepHistory = [];

    async function fetchData() {
      try {
        const res = await fetch('/status');
        const data = await res.json();

        // Update text
        document.getElementById('stepCount').textContent = data.stepCount || '--';
        document.getElementById('todaySteps').textContent = data.stepCount || '--';
        document.getElementById('voltage').textContent = (data.voltage || '--') + ' V';

        const battery = data.battery || 0;
        document.getElementById('batteryText').textContent = battery + '%';
        document.getElementById('batteryGauge').style.background = 
          `conic-gradient(#00bfff ${battery}%, #111 ${battery}%)`;

        // LED Statuses
        let ledHTML = '';
        for (let i = 1; i <= 6; i++) {
          const status = data.ledStatus && data.ledStatus['LED' + i] ? data.ledStatus['LED' + i] : '--';
          ledHTML += `LED${i} status: ${status}<br>`;
        }
        document.getElementById('ledStatus').innerHTML = ledHTML;

        // Update chart
        const now = new Date();
        const label = now.getHours() + ':' + String(now.getMinutes()).padStart(2, '0');
        if (stepHistory.length >= 10) stepHistory.shift();
        stepHistory.push({ x: label, y: data.stepCount || 0 });

        stepChart.data.labels = stepHistory.map(d => d.x);
        stepChart.data.datasets[0].data = stepHistory.map(d => d.y);
        stepChart.update();
      } catch (e) {
        console.error('Fetch failed', e);
      }
    }

    setInterval(fetchData, 1000);
  </script>
</body>
</html>
